<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å®¢æœ - æ™ºèƒ½åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #e2e8f0;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .ai-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: rgba(26, 32, 44, 0.8);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 16px;
            border-radius: 12px;
            height: 420px;
            overflow: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .msg {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 0;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }
        
        .msg.agent {
            background: rgba(66, 153, 225, 0.2);
            border-left: 4px solid #4299e1;
            align-self: flex-start;
        }
        
        .msg.user {
            background: rgba(72, 187, 120, 0.2);
            border-right: 4px solid #48bb78;
            align-self: flex-end;
            margin-left: auto;
        }
        
        .msg.system {
            background: rgba(237, 137, 54, 0.2);
            border-left: 4px solid #ed8936;
            text-align: center;
            max-width: 100%;
            font-size: 0.9em;
        }
        
        .ai-input {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .ai-input input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: #e2e8f0;
            font-size: 16px;
        }
        
        .ai-input input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        .ai-input input::placeholder {
            color: #a0aec0;
        }
        
        .primary-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.4);
        }
        
        .primary-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .quick-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e2e8f0;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            text-align: center;
        }
        
        .quick-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .typing-indicator {
            display: none;
            align-items: center;
            padding: 12px 16px;
            background: rgba(66, 153, 225, 0.2);
            border-left: 4px solid #4299e1;
            border-radius: 8px;
            margin: 12px 0;
            max-width: 80%;
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4299e1;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        a {
            color: #63b3ed;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #a0aec0;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .chat-box::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-box::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }
        
        .chat-box::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .ai-container {
                margin: 20px 10px;
                padding: 15px;
            }
            
            .chat-box {
                height: 350px;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="ai-container">
        <div class="chat-header">
            <h1>ğŸ¤– AI å®¢æœåŠ©æ‰‹</h1>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>åœ¨çº¿</span>
            </div>
        </div>
        
        <p>æ™ºèƒ½å®¢æœå·²å°±ç»ªï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ</p>

        <div class="chat-box" id="ai-chat">
            <div class="msg agent">æ‚¨å¥½ï¼Œæˆ‘æ˜¯AIå®¢æœåŠ©æ‰‹ï¼Œå¯ä»¥ä¸ºæ‚¨è§£ç­”å…³äºè´¦å·å°ç¦ã€ç”³è¯‰æµç¨‹ã€æ¸¸æˆé—®é¢˜ç­‰æ–¹é¢çš„ç–‘é—®ã€‚è¯·ç®€è¦æè¿°æ‚¨çš„é—®é¢˜ã€‚</div>
            <div class="msg system">ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥ç‚¹å‡»ä¸‹æ–¹å¿«æ·é—®é¢˜æˆ–ç›´æ¥è¾“å…¥æ‚¨çš„é—®é¢˜</div>
        </div>

        <div class="quick-actions">
            <button class="quick-btn" data-question="ä¸ºä»€ä¹ˆæˆ‘çš„è´¦å·è¢«å°äº†ï¼Ÿ">è´¦å·å°ç¦åŸå› </button>
            <button class="quick-btn" data-question="å¦‚ä½•ç”³è¯‰è§£å°ï¼Ÿ">ç”³è¯‰è§£å°æµç¨‹</button>
            <button class="quick-btn" data-question="æ¸¸æˆè¿è¡Œä¸ç¨³å®šæ€ä¹ˆåŠï¼Ÿ">æ¸¸æˆé—®é¢˜</button>
            <button class="quick-btn" data-question="è§£å°éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ">å¤„ç†æ—¶é—´</button>
        </div>

        <div class="ai-input">
            <input id="ai-input" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šè´¦å·å°ç¦åŸå› ã€ç”³è¯‰æµç¨‹...">
            <button id="ai-send" class="primary-btn">å‘é€</button>
        </div>

        <div style="margin-top:12px; text-align: center;">
            <a href="unban_lottery.html">â† è¿”å›è§£å°æŠ½å–é¡µé¢</a>
        </div>
    </div>

    <div class="typing-indicator" id="typing-indicator">
        <span>å®¢æœæ­£åœ¨è¾“å…¥</span>
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ 
        const chat = document.getElementById('ai-chat');
        const input = document.getElementById('ai-input');
        const send = document.getElementById('ai-send');
        const typingIndicator = document.getElementById('typing-indicator');
        const quickButtons = document.querySelectorAll('.quick-btn');

        // æ™ºèƒ½å®¢æœå“åº”ç³»ç»Ÿ
        const responseSystem = {
            // æ„å›¾è¯†åˆ«å…³é”®è¯
            intents: {
                greeting: { keywords: ['ä½ å¥½', 'æ‚¨å¥½', 'hello', 'hi', 'åœ¨å—', 'æœ‰äººå—'], priority: 1 },
                banReason: { keywords: ['ä¸ºä»€ä¹ˆå°', 'å°å·åŸå› ', 'ä¸ºä½•å°', 'å°ç¦ç†ç”±', 'ä¸ºä»€ä¹ˆè¢«å°', 'åŸå› '], priority: 5 },
                appeal: { keywords: ['ç”³è¯‰', 'è§£å°', 'ç”³è¯·è§£å°', 'å¦‚ä½•è§£å°', 'æ€ä¹ˆè§£å°', 'æ¢å¤è´¦å·'], priority: 5 },
                gameIssue: { keywords: ['æ¸¸æˆå¡', 'é—ªé€€', 'è¿è¡Œä¸äº†', 'æ‰“ä¸å¼€', 'bug', 'é”™è¯¯', 'é—®é¢˜'], priority: 4 },
                time: { keywords: ['å¤šä¹…', 'å¤šé•¿æ—¶é—´', 'ä½•æ—¶', 'æ—¶é—´', 'å‡ å¤©', 'ä»€ä¹ˆæ—¶å€™'], priority: 3 },
                complaint: { keywords: ['æŠ•è¯‰', 'ä¸¾æŠ¥', 'ä¸æ»¡', 'æ„è§', 'å»ºè®®', 'åé¦ˆ'], priority: 4 },
                thanks: { keywords: ['è°¢è°¢', 'æ„Ÿè°¢', 'å¤šè°¢', 'thx', '3q'], priority: 2 },
                goodbye: { keywords: ['å†è§', 'æ‹œæ‹œ', 'é€€å‡º', 'ç»“æŸ', '88'], priority: 1 }
            },
            
            // å“åº”æ¨¡æ¿
            responses: {
                greeting: [
                    "æ‚¨å¥½ï¼æˆ‘æ˜¯AIå®¢æœåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ",
                    "æ‚¨å¥½ï¼Œå®¢æœåŠ©æ‰‹ä¸ºæ‚¨æœåŠ¡ï¼Œè¯·æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜ã€‚",
                    "æ‚¨å¥½ï¼Œè¯·é—®éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ"
                ],
                banReason: [
                    "è´¦å·å°ç¦é€šå¸¸æ˜¯ç”±äºè¿åç”¨æˆ·åè®®å¯¼è‡´çš„ï¼Œå¸¸è§åŸå› åŒ…æ‹¬ï¼šæ¸¸æˆè¶…æ—¶ã€å¼‚å¸¸è¡Œä¸ºã€å¤šæ¬¡è¿è§„ç­‰ã€‚å…·ä½“åŸå› éœ€è¦æŸ¥çœ‹æ‚¨çš„è´¦å·è®°å½•ã€‚",
                    "å°ç¦åŸå› å¯èƒ½åŒ…æ‹¬ï¼š1) æ¸¸æˆè¶…æ—¶è§¦å‘ç³»ç»Ÿè‡ªåŠ¨å°ç¦ 2) æ£€æµ‹åˆ°å¼‚å¸¸æ“ä½œ 3) å¤šæ¬¡è¿åç¤¾åŒºå‡†åˆ™ã€‚æ‚¨å¯ä»¥é€šè¿‡ç”³è¯‰äº†è§£å…·ä½“åŸå› ã€‚",
                    "ç³»ç»Ÿæ£€æµ‹åˆ°è´¦å·å­˜åœ¨å¼‚å¸¸æ´»åŠ¨æˆ–è¿åå¹³å°è§„åˆ™çš„è¡Œä¸ºã€‚å¦‚éœ€è¯¦ç»†äº†è§£ï¼Œè¯·æä¾›è´¦å·ä¿¡æ¯è¿›è¡ŒæŸ¥è¯¢ã€‚"
                ],
                appeal: [
                    "ç”³è¯‰è§£å°æµç¨‹ï¼š1) å¡«å†™ç”³è¯‰è¡¨å• 2) æä¾›ç›¸å…³è¯æ˜ 3) ç­‰å¾…å®¡æ ¸ï¼ˆé€šå¸¸1-3ä¸ªå·¥ä½œæ—¥ï¼‰4) æŸ¥çœ‹å®¡æ ¸ç»“æœã€‚æ™®é€šç”¨æˆ·ç”³è¯‰ä¸ä¼šè‡ªåŠ¨è§£å°ã€‚",
                    "å¦‚éœ€ç”³è¯‰ï¼Œè¯·æä¾›ï¼šè´¦å·æ˜µç§°ã€å°ç¦æ—¶é—´ã€æ‚¨è®¤ä¸ºå°ç¦é”™è¯¯çš„åŸå› ã€‚æˆ‘ä»¬çš„å®¢æœå›¢é˜Ÿä¼šåœ¨æ ¸å®åç»™äºˆå›å¤ã€‚",
                    "è§£å°ç”³è¯‰éœ€è¦ç»è¿‡äººå·¥å®¡æ ¸ã€‚è¯·ç¡®ä¿æä¾›çœŸå®æœ‰æ•ˆçš„ä¿¡æ¯ï¼Œå®¡æ ¸æœŸé€šå¸¸ä¸º1-5ä¸ªå·¥ä½œæ—¥ã€‚"
                ],
                gameIssue: [
                    "æ¸¸æˆè¿è¡Œé—®é¢˜å¯èƒ½æ˜¯ç”±äºç½‘ç»œè¿æ¥ã€è®¾å¤‡å…¼å®¹æ€§æˆ–æ¸¸æˆç‰ˆæœ¬é—®é¢˜å¯¼è‡´ã€‚å»ºè®®ï¼š1) æ£€æŸ¥ç½‘ç»œ 2) é‡å¯æ¸¸æˆ 3) æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚",
                    "å¦‚æœæ‚¨é‡åˆ°æ¸¸æˆå¡é¡¿æˆ–é—ªé€€ï¼Œå¯ä»¥å°è¯•ï¼šæ¸…ç†ç¼“å­˜ã€å…³é—­åå°åº”ç”¨ã€æ£€æŸ¥è®¾å¤‡å­˜å‚¨ç©ºé—´ã€‚å¦‚é—®é¢˜æŒç»­ï¼Œè¯·æä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚",
                    "æ¸¸æˆæŠ€æœ¯é—®é¢˜æˆ‘ä»¬çš„å¼€å‘å›¢é˜Ÿæ­£åœ¨æŒç»­ä¼˜åŒ–ã€‚æ‚¨å¯ä»¥å°è¯•é‡æ–°å®‰è£…æ¸¸æˆæˆ–è”ç³»æŠ€æœ¯æ”¯æŒè·å–æ›´è¯¦ç»†çš„å¸®åŠ©ã€‚"
                ],
                time: [
                    "ç”³è¯‰å¤„ç†æ—¶é—´é€šå¸¸ä¸º1-3ä¸ªå·¥ä½œæ—¥ï¼Œå¤æ‚æƒ…å†µå¯èƒ½éœ€è¦5-7å¤©ã€‚æˆ‘ä»¬ä¼šé€šè¿‡ç³»ç»Ÿæ¶ˆæ¯é€šçŸ¥æ‚¨å®¡æ ¸ç»“æœã€‚",
                    "è§£å°å®¡æ ¸æ—¶é—´è§†æƒ…å†µè€Œå®šï¼Œä¸€èˆ¬éœ€è¦1-5ä¸ªå·¥ä½œæ—¥ã€‚èŠ‚å‡æ—¥å¯èƒ½ä¼šæœ‰æ‰€å»¶é•¿ï¼Œè¯·æ‚¨è€å¿ƒç­‰å¾…ã€‚",
                    "å®¢æœå›å¤æ—¶é—´é€šå¸¸åœ¨24å°æ—¶å†…ï¼Œç´§æ€¥é—®é¢˜æˆ‘ä»¬ä¼šä¼˜å…ˆå¤„ç†ã€‚æ‚¨å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¸­å¿ƒæŸ¥çœ‹å¤„ç†è¿›åº¦ã€‚"
                ],
                complaint: [
                    "æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼Œæˆ‘ä»¬ä¼šè®¤çœŸè®°å½•å¹¶æ”¹è¿›ã€‚è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜ï¼Œä»¥ä¾¿æˆ‘ä»¬æ›´å¥½åœ°ä¸ºæ‚¨æœåŠ¡ã€‚",
                    "æŠ±æ­‰ç»™æ‚¨å¸¦æ¥ä¸ä¾¿ï¼Œè¯·æä¾›å…·ä½“æŠ•è¯‰å†…å®¹ï¼Œæˆ‘ä»¬çš„å®¢æœå›¢é˜Ÿä¼šå°½å¿«æ ¸å®å¹¶å¤„ç†ã€‚",
                    "æˆ‘ä»¬é‡è§†æ¯ä¸€ä½ç”¨æˆ·çš„æ„è§ï¼Œæ‚¨çš„åé¦ˆå°†å¸®åŠ©æˆ‘ä»¬æå‡æœåŠ¡è´¨é‡ã€‚è¯·æè¿°å…·ä½“æƒ…å†µï¼Œæˆ‘ä»¬ä¼šåŠæ—¶å¤„ç†ã€‚"
                ],
                thanks: [
                    "ä¸å®¢æ°”ï¼Œå¾ˆé«˜å…´èƒ½æ°¸å°æ‚¨ï¼å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ä»¬ã€‚",
                    "æ„Ÿè°¢æ‚¨çš„è®¤å¯ï¼Œç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼",
                    "æ‚¨å¤ªå®¢æ°”äº†ï¼Œè¿™æ˜¯æˆ‘ä»¬åº”è¯¥åšçš„ã€‚æœ‰é—®é¢˜éšæ—¶æ¥æ‰¾æˆ‘ï¼"
                ],
                goodbye: [
                    "æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï¼Œå†è§ï¼å¦‚æœ‰é—®é¢˜æ¬¢è¿éšæ—¶å›æ¥ã€‚",
                    "å†è§ï¼Œç¥æ‚¨æœ‰æ„‰å¿«çš„ä¸€å¤©ï¼",
                    "æ„Ÿè°¢ä½¿ç”¨æˆ‘ä»¬çš„æœåŠ¡ï¼ŒæœŸå¾…å†æ¬¡ä¸ºæ‚¨æœåŠ¡ï¼"
                ],
                fallback: [
                    "æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰å®Œå…¨ç†è§£æ‚¨çš„é—®é¢˜ã€‚æ‚¨å¯ä»¥æ›´å…·ä½“åœ°æè¿°ä¸€ä¸‹å—ï¼Ÿ",
                    "æ‚¨çš„é—®é¢˜å¯èƒ½éœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œèƒ½å¦å†è§£é‡Šä¸€ä¸‹ï¼Ÿ",
                    "æˆ‘ç›®å‰ä¸»è¦å¤„ç†è´¦å·å°ç¦ã€ç”³è¯‰è§£å°ã€æ¸¸æˆé—®é¢˜ç­‰ç›¸å…³å’¨è¯¢ï¼Œè¯·é—®æ‚¨å…·ä½“é‡åˆ°ä»€ä¹ˆæƒ…å†µï¼Ÿ"
                ]
            },
            
            // ç‰¹æ®Šæƒ…å¢ƒå“åº”
            specialCases: {
                urgent: {
                    keywords: ['ç´§æ€¥', 'æ€¥éœ€', 'é©¬ä¸Š', 'ç«‹åˆ»', 'å¿«ç‚¹', 'åŠ æ€¥'],
                    response: "ç†è§£æ‚¨çš„ç´§æ€¥æƒ…å†µï¼Œæˆ‘ä»¬ä¼šä¼˜å…ˆå¤„ç†æ‚¨çš„é—®é¢˜ã€‚è¯·æä¾›è¯¦ç»†ä¿¡æ¯ä»¥ä¾¿æˆ‘ä»¬å¿«é€Ÿå“åº”ã€‚"
                },
                angry: {
                    keywords: ['åƒåœ¾', 'åºŸç‰©', 'å‘çˆ¹', 'éª—äºº', 'æŠ•è¯‰', 'ä¸¾æŠ¥', 'ç”Ÿæ°”', 'æ„¤æ€’','è®¨åŒ','æ¶å¿ƒ'],
                    response: "éå¸¸æŠ±æ­‰ç»™æ‚¨å¸¦æ¥ä¸æ„‰å¿«çš„ä½“éªŒï¼Œæˆ‘ä»¬ä¼šè®¤çœŸå¯¹å¾…æ‚¨çš„é—®é¢˜å¹¶å°½å¿«è§£å†³ã€‚è¯·å‘Šè¯‰æˆ‘ä»¬å…·ä½“æƒ…å†µï¼Œæˆ‘ä»¬ä¼šå°½åŠ›å¸®åŠ©æ‚¨ã€‚"
                },
                repeat: {
                    response: "æ‚¨ä¼¼ä¹å¯¹ä¹‹å‰çš„å›ç­”è¿˜æœ‰ç–‘é—®ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“å“ªæ–¹é¢éœ€è¦è¿›ä¸€æ­¥è§£é‡Šï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºæ‚¨è¯´æ˜ã€‚"
                }
            },
            
            // å¯¹è¯å†å²
            conversationHistory: [],
            
            // åˆ†æç”¨æˆ·æ„å›¾
            analyzeIntent(message) {
                message = message.toLowerCase().trim();
                let detectedIntents = [];
                
                // æ£€æŸ¥ç‰¹æ®Šæƒ…å¢ƒ
                for (const [caseType, caseData] of Object.entries(this.specialCases)) {
                    if (caseData.keywords) {
                        for (const keyword of caseData.keywords) {
                            if (message.includes(keyword)) {
                                return { intent: 'special', case: caseType, confidence: 0.9 };
                            }
                        }
                    }
                }
                
                // æ£€æŸ¥é‡å¤é—®é¢˜
                if (this.conversationHistory.length > 0) {
                    const lastUserMessage = this.conversationHistory[this.conversationHistory.length - 2];
                    if (lastUserMessage && lastUserMessage.role === 'user') {
                        // ç®€å•ç›¸ä¼¼åº¦æ£€æµ‹
                        const similarity = this.calculateSimilarity(message, lastUserMessage.content.toLowerCase());
                        if (similarity > 0.7) {
                            return { intent: 'repeat', confidence: 0.8 };
                        }
                    }
                }
                
                // å¸¸è§„æ„å›¾æ£€æµ‹
                for (const [intent, data] of Object.entries(this.intents)) {
                    for (const keyword of data.keywords) {
                        if (message.includes(keyword)) {
                            detectedIntents.push({
                                intent: intent,
                                confidence: 0.7 + (0.3 * (keyword.length / 10)) // æ ¹æ®å…³é”®è¯é•¿åº¦è°ƒæ•´ç½®ä¿¡åº¦
                            });
                            break;
                        }
                    }
                }
                
                if (detectedIntents.length > 0) {
                    // è¿”å›ç½®ä¿¡åº¦æœ€é«˜çš„æ„å›¾
                    detectedIntents.sort((a, b) => b.confidence - a.confidence);
                    return detectedIntents[0];
                }
                
                return { intent: 'fallback', confidence: 0.1 };
            },
            
            // è®¡ç®—æ–‡æœ¬ç›¸ä¼¼åº¦ï¼ˆç®€æ˜“ç‰ˆï¼‰
            calculateSimilarity(text1, text2) {
                const words1 = new Set(text1.split(/\s+/));
                const words2 = new Set(text2.split(/\s+/));
                const intersection = new Set([...words1].filter(x => words2.has(x)));
                const union = new Set([...words1, ...words2]);
                return intersection.size / union.size;
            },
            
            // ç”Ÿæˆå“åº”
            generateResponse(intentData) {
                let response;
                
                if (intentData.intent === 'special') {
                    response = this.specialCases[intentData.case].response;
                } else if (intentData.intent === 'repeat') {
                    response = this.specialCases.repeat.response;
                } else {
                    const possibleResponses = this.responses[intentData.intent] || this.responses.fallback;
                    response = possibleResponses[Math.floor(Math.random() * possibleResponses.length)];
                }
                
                // 80%å‡ ç‡æ·»åŠ åç»­é—®é¢˜å»ºè®®
                if (Math.random() < 0.8 && intentData.intent !== 'thanks' && intentData.intent !== 'goodbye') {
                    const followUps = [
                        "è¿˜æœ‰å…¶ä»–é—®é¢˜éœ€è¦å¸®åŠ©å—ï¼Ÿ",
                        "è¯·é—®è¿˜æœ‰å…¶ä»–ç–‘é—®å—ï¼Ÿ",
                        "å¦‚æœè¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚"
                    ];
                    response += " " + followUps[Math.floor(Math.random() * followUps.length)];
                }
                
                return response;
            },
            
            // æ·»åŠ ä¸Šä¸‹æ–‡åˆ°å†å²
            addToHistory(role, content) {
                this.conversationHistory.push({ role, content, timestamp: new Date() });
                // ä¿æŒå†å²è®°å½•ä¸è¶…è¿‡10æ¡
                if (this.conversationHistory.length > 10) {
                    this.conversationHistory.shift();
                }
            }
        };

        // æ˜¾ç¤ºæ¶ˆæ¯å‡½æ•°
        function appendMsg(role, text) {
            const msgElement = document.createElement('div');
            msgElement.className = `msg ${role}`;
            msgElement.textContent = text;
            chat.appendChild(msgElement);
            chat.scrollTop = chat.scrollHeight;
        }

        // æ˜¾ç¤ºè¾“å…¥æŒ‡ç¤ºå™¨
        function showTypingIndicator() {
            typingIndicator.style.display = 'flex';
            chat.appendChild(typingIndicator);
            chat.scrollTop = chat.scrollHeight;
        }

        // éšè—è¾“å…¥æŒ‡ç¤ºå™¨
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // å¤„ç†ç”¨æˆ·æ¶ˆæ¯
        function processUserMessage(message) {
            // æ·»åŠ åˆ°å¯¹è¯å†å²
            responseSystem.addToHistory('user', message);
            
            // æ˜¾ç¤º"æ­£åœ¨è¾“å…¥"æŒ‡ç¤ºå™¨
            showTypingIndicator();
            
            // æ¨¡æ‹ŸAIå¤„ç†æ—¶é—´
            setTimeout(() => {
                hideTypingIndicator();
                
                // åˆ†æç”¨æˆ·æ„å›¾
                const intent = responseSystem.analyzeIntent(message);
                
                // ç”Ÿæˆå“åº”
                const response = responseSystem.generateResponse(intent);
                
                // æ˜¾ç¤ºAIå“åº”
                appendMsg('agent', response);
                
                // æ·»åŠ åˆ°å¯¹è¯å†å²
                responseSystem.addToHistory('agent', response);
            }, 1000 + Math.random() * 1000); // éšæœºå»¶è¿Ÿ1-2ç§’
        }

        // å‘é€æŒ‰é’®äº‹ä»¶
        send.addEventListener('click', () => {
            const message = input.value.trim();
            if (!message) return;
            
            appendMsg('user', message);
            input.value = '';
            processUserMessage(message);
        });

        // å›è½¦é”®å‘é€
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                send.click();
            }
        });

        // å¿«æ·é—®é¢˜æŒ‰é’®
        quickButtons.forEach(button => {
            button.addEventListener('click', () => {
                const question = button.getAttribute('data-question');
                input.value = question;
                send.click();
            });
        });

        // é¡µé¢åŠ è½½æ—¶èšç„¦è¾“å…¥æ¡†
        window.addEventListener('load', () => {
            input.focus();
        });
    </script>
</body>
</html>